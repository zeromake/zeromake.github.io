---
title: 游戏框架设计
date: 2021-05-17 16:51:26 +08:00
tags:
  - framework
  - design
  - server
lastmod: 2021-05-17 16:51:26 +08:00
categories:
  - go
  - game
slug: game-framework-design
draft: true
---

## 前言

1. 最近进入了手机网络游戏行业，对高频交互服务端需要有一个自己理解产出。
2. 所以会参考各个开源对游戏服务端框架来设计自己理想中的游戏服务框架。

## 一、目标

1. 核心要小，其他的功能必须通过各种插件与中间件来扩展。
1. 网关的连接读取触发方式需要支持 `gnet` 之类的回调。
1. 路由执行需要支持隔离性设置，即为该路由的同时执行粒度。
1. 支持 connector(连接器), logic(逻辑执行), master-manager(集群主控) 服务拆分，也支持集成执行部署。
1. 客户端应当支持订阅主题接收推送(工会聊天，区服聊天，广告通知等)。
1. 使用代码生成和反射来简化各种方法注册，序列化。

## 二、中间件设计

中间为路由执行前后的一个插件方案，一般用于访问日志，链路追踪，访问限制。

## 三、插件设计

有些 http 框架喜欢使用中间件的方式去做插件，考虑了一下决定把插件拆出来，主要能力为网关，解码编码，加解密，路由分发，注册中心，rpc 调用注册。

## 四、网关设计

## 五、路由设计

## 六、路由隔离执行设计

例如同一个连接下只能串行，该服务内只能串行，以及不做任何限制的并行(考虑是否使用协程池)，以及各种隔离例如自定义 key 隔离。

## 七、远端逻辑执行设计


## 八、可组合式的服务划分

不论是哪个服务划分都应当能够与之合并为一个服务也可以，也可以随意的拆分服务进行部署。

## 九、日志方案设计

## 十、集群管理器设计

## 十一、链路追踪

## 十二、无人值守 dump 日志

## 十三、通信协议封装

## 十四、通信加密

## 十五、用户数据与数据库同步

## 十六、服务器集群配置

## 十八、游戏逻辑配置

## 十九、单元测试

## 二十、并发压力测试

## 二十一、全链路单元测试

## 参考

1. [pomelo](https://github.com/NetEase/pomelo) 一个网易开源的 node.js 游戏服务框架。
1. [pinus](https://github.com/node-pinus/pinus) 原型来自 pomelo 的一个 ts 编写的 node.js 游戏服务框架。
1. [leaf](https://github.com/name5566/leaf) 一个 go 编写的开源游戏服务框架。
1. [nano](https://github.com/lonng/nano) 一个 go 编写的开源游戏服务框架，与 leaf 类似。
