{"title":"vue_not_webpack_router_async","date":"2016-11-07T17:13:25.000Z","tags":["vue2","router","async"],"last_date":"2016-11-07T18:00:20.000Z","filename":"vue_not_webpack_router_async","body":"<h1><a class=\"anchor\" name=\"vue不使用webpack,vue_router怎么异步\" href=\"#vue不使用webpack,vue_router怎么异步\"><svg aria-hidden=\"true\" class=\"octicon octicon-link\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>vue不使用webpack,vue_router怎么异步</h1><p>公司项目都是后台管理项，肯定是导航加主显示区的方式切换，然后就想着用vue_router看看。\n然后发现vue_router的component是同步加载的。。要是后台功能多js就很大了，这个就是所谓的单页应用。\n但是单页应用不用webpack打包手动把js写一个也太蛋疼了。然后发现了webpack用chunk可以异步会把每个路由的js单独打包。\n具体的原理下面也会讲解。</p>\n<h2><a class=\"anchor\" name=\"零、一些注意事项\" href=\"#零、一些注意事项\"><svg aria-hidden=\"true\" class=\"octicon octicon-link\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>零、一些注意事项</h2><ol class=\"contains-list\">\n<li class=\"list-item\">源码在<a href=\"https://github.com/zeromake/vue_demo\">这里</a></li>\n</ol>\n<h2><a class=\"anchor\" name=\"一、vue_router_demo\" href=\"#一、vue_router_demo\"><svg aria-hidden=\"true\" class=\"octicon octicon-link\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>一、vue_router_demo</h2><p>先来个vue_router的demo用requirejs加载其它js。</p>\n<h3><a class=\"anchor\" name=\"vue_router_demo.html\" href=\"#vue_router_demo.html\"><svg aria-hidden=\"true\" class=\"octicon octicon-link\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>vue_router_demo.html</h3><pre class=\"code html\"><code class=\"html\"><span class=\"hljs-meta\">&lt;!DOCTYPE html&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">html</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">\"zh\"</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">head</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">charset</span>=<span class=\"hljs-string\">\"UTF-8\"</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"viewport\"</span> <span class=\"hljs-attr\">content</span>=<span class=\"hljs-string\">\"width=device-width, initial-scale=1\"</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">http-equiv</span>=<span class=\"hljs-string\">\"X-UA-Compatible\"</span> <span class=\"hljs-attr\">content</span>=<span class=\"hljs-string\">\"IE=edge\"</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">title</span>&gt;</span>Title<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">title</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">\"text/javascript\"</span> <span class=\"hljs-attr\">data-main</span>=<span class=\"hljs-string\">\"js/main.js\"</span>\n    <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">\"./bower_components/requirejs/require.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">head</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">body</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"app\"</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">body</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">html</span>&gt;</span>\n</code></pre>\n<h3><a class=\"anchor\" name=\"js/main.js\" href=\"#js/main.js\"><svg aria-hidden=\"true\" class=\"octicon octicon-link\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>js/main.js</h3><pre class=\"code javascript\"><code class=\"javascript\">(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">require, define</span>) </span>{\n    <span class=\"hljs-built_in\">require</span>.config({\n        <span class=\"hljs-attr\">paths</span>: {\n            <span class=\"hljs-string\">'vue'</span>: <span class=\"hljs-string\">'https://cdn.bootcss.com/vue/2.0.5/vue'</span>,\n            <span class=\"hljs-string\">'vue-router'</span>: <span class=\"hljs-string\">'https://cdn.bootcss.com/vue-router/2.0.1/vue-router'</span>\n        }\n    });\n\n    define(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">require, exports, module</span>) </span>{\n        <span class=\"hljs-keyword\">var</span> Vue = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'vue'</span>);\n        <span class=\"hljs-keyword\">var</span> VueRouter = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'vue-router'</span>);\n        Vue.use(VueRouter);\n        <span class=\"hljs-keyword\">var</span> router = <span class=\"hljs-keyword\">new</span> VueRouter({\n            <span class=\"hljs-attr\">routes</span>: [{\n                    <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">'/component1'</span>,\n                    <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">resolve</span>) </span>{\n                        resolve(<span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'js/component1.js'</span>));\n                    }\n                },\n                {\n                    <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">'/component2'</span>,\n                    <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">resolve</span>) </span>{\n                        resolve(<span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'js/component2.js'</span>));\n                    }\n                },\n            ]\n        })\n        <span class=\"hljs-keyword\">var</span> app = <span class=\"hljs-keyword\">new</span> Vue({\n            <span class=\"hljs-attr\">el</span>: <span class=\"hljs-string\">'#app'</span>,\n            <span class=\"hljs-attr\">router</span>: router,\n            <span class=\"hljs-attr\">template</span>: <span class=\"hljs-string\">'&lt;div class=\"content\"&gt;\\\n            &lt;h1&gt;Hello Content!&lt;/h1&gt;\\\n            &lt;p&gt;\\\n             &lt;router-link to=\"/component1\"&gt;Go to Component1&lt;/router-link&gt;\\\n             &lt;router-link to=\"/component2\"&gt;Go to Component2&lt;/router-link&gt;\\\n            &lt;/p&gt;\\\n            &lt;router-view&gt;&lt;/router-view&gt;\\\n            &lt;/div&gt;'</span>\n        });\n    });\n})(<span class=\"hljs-built_in\">require</span>, define);\n</code></pre>\n<h3><a class=\"anchor\" name=\"js/component1.js\" href=\"#js/component1.js\"><svg aria-hidden=\"true\" class=\"octicon octicon-link\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>js/component1.js</h3><pre class=\"code javascript\"><code class=\"javascript\">(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">define</span>)</span>{\n    define(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">require, exports, module</span>)</span>{\n        <span class=\"hljs-keyword\">return</span> {\n            <span class=\"hljs-attr\">template</span>: <span class=\"hljs-string\">'&lt;span&gt;component1&lt;/span&gt;'</span>\n        }\n    });\n})(define);\n</code></pre>\n<p>我看了webpack的.vue编译完后导出的对象也不过是有特定属性的对象，必须有<code>template</code>或者<code>render</code>其中一个。</p>\n<h3><a class=\"anchor\" name=\"js/component2.js\" href=\"#js/component2.js\"><svg aria-hidden=\"true\" class=\"octicon octicon-link\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>js/component2.js</h3><pre class=\"code javascript\"><code class=\"javascript\">(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">define</span>)</span>{\n    define(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">require, exports, module</span>)</span>{\n        <span class=\"hljs-keyword\">return</span> {\n            <span class=\"hljs-attr\">template</span>: <span class=\"hljs-string\">'&lt;h1&gt;component2&lt;/h1&gt;'</span>\n        }\n    });\n})(define);\n</code></pre>\n<p>再来一个不一样的。</p>\n<h3><a class=\"anchor\" name=\"示例效果图\" href=\"#示例效果图\"><svg aria-hidden=\"true\" class=\"octicon octicon-link\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>示例效果图</h3><p><img src=\"/public/img/vue_not_webpack_router-async/vue_router_demo.gif\" alt=\"vue_router_demo\"></p>\n<h3><a class=\"anchor\" name=\"源码\" href=\"#源码\"><svg aria-hidden=\"true\" class=\"octicon octicon-link\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>源码</h3><p>在git仓库的vue_router_demo分支。</p>\n<h3><a class=\"anchor\" name=\"总结\" href=\"#总结\"><svg aria-hidden=\"true\" class=\"octicon octicon-link\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>总结</h3><p>看了图我想你已经发现了问题明明<code>component</code>用的require但是怎么回事第一次刷新首页都引入了。\n实际上因为requirejs的require会收集所有使用require的地方并一同加载甚至定义一个方法里就require一个模块，也会预先加载js。\n这个结果照成我们的异步变成了多文件SPA在一开始就会把所有模块导入。如果想做这样的SPA不要使用这样的方法，请使用webpack打包成一个文件减少请求。</p>\n<h2><a class=\"anchor\" name=\"二、vue_router_async_demo\" href=\"#二、vue_router_async_demo\"><svg aria-hidden=\"true\" class=\"octicon octicon-link\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>二、vue_router_async_demo</h2><p>现在我们就来一步步分析怎么做到。</p>\n<h3><a class=\"anchor\" name=\"查找资料\" href=\"#查找资料\"><svg aria-hidden=\"true\" class=\"octicon octicon-link\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>查找资料</h3><p>通过搜索引擎的查找翻到了一篇博文<a href=\"http://www.cnblogs.com/Kummy/p/5254754.html\">分享（Angular 和 Vue）按需加载的项目实践优化方案</a>\n里面给了他的参考资料：</p>\n<blockquote>\n<ol class=\"contains-list\">\n<li class=\"list-item\"><a href=\"https://cn.vuejs.org/v2/guide/components.html#%E5%BC%82%E6%AD%A5%E7%BB%84%E4%BB%B6\">异步组件</a></li>\n<li class=\"list-item\"><a href=\"http://webpack.github.io/docs/code-splitting.html\">webpack</a></li>\n</ol>\n</blockquote>\n<p>然后我写了一个测试效果是我想要的异步。然后看了生成的代码异步用的js的开头<code>webpackJsonp([1,3],[...])</code>。\n而导入模块的地方使用<code>__webpack_require__([1,3], resolve)</code>还有<code>__webpack_require__</code>中有这样一段代码:</p>\n<pre class=\"code javascript\"><code class=\"javascript\"><span class=\"hljs-keyword\">var</span> head = <span class=\"hljs-built_in\">document</span>.getElementsByTagName(<span class=\"hljs-string\">'head'</span>)[<span class=\"hljs-number\">0</span>];\n<span class=\"hljs-keyword\">var</span> script = <span class=\"hljs-built_in\">document</span>.createElement(<span class=\"hljs-string\">'script'</span>);\nscript.type = <span class=\"hljs-string\">'text/javascript'</span>;\nscript.charset = <span class=\"hljs-string\">'utf-8'</span>;\nscript.async = <span class=\"hljs-literal\">true</span>;\nscript.src = <span class=\"hljs-string\">''</span><span class=\"hljs-comment\">// del;</span>\nhead.appendChild(script);\n</code></pre>\n<p>这下就明白了<code>__webpack_require__(chunkIds, callback)</code>调用后查找是否已有<code>chunkIds</code>的模块有的话通过<code>callback</code>调用返回。\n没有就通过<code>chunkIds</code>找到文件并在<code>head</code>中添加一个<code>script</code>加载新js然后js中调用<code>webpackJsonp</code>并通过<code>callback</code>返回模块。</p>\n<p>好了这下找到方法了我们自己写个<code>webpackJsonp</code>和<code>webpack_require</code>就好了。代码可能有点多用注释的方式来解释。</p>\n<h3><a class=\"anchor\" name=\"js/webpackjsonp.js\" href=\"#js/webpackjsonp.js\"><svg aria-hidden=\"true\" class=\"octicon octicon-link\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>js/webpackjsonp.js</h3><pre class=\"code javascript\"><code class=\"javascript\">(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">define</span>) </span>{\n    define(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) </span>{\n        <span class=\"hljs-comment\">// 模块缓存区。</span>\n        <span class=\"hljs-keyword\">var</span> webpackJsonpModule = {};\n        <span class=\"hljs-comment\">// 回调方法缓存区。</span>\n        <span class=\"hljs-keyword\">var</span> webpackInstallModule = {};\n        <span class=\"hljs-comment\">// 引入的js所需调用的方法。</span>\n        <span class=\"hljs-keyword\">var</span> webpackJsonpCallback = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">webpackJsonpCallback_</span>(<span class=\"hljs-params\">chunkName, Module</span>) </span>{\n            <span class=\"hljs-comment\">// 判断模块名</span>\n            <span class=\"hljs-keyword\">if</span> (webpackJsonpModule[chunkName]) {\n                <span class=\"hljs-built_in\">console</span>.warn(<span class=\"hljs-string\">'模块名: '</span> + chunkName + <span class=\"hljs-string\">'已存在!为其旧模块重命名到:'</span> + chunkName + <span class=\"hljs-string\">'_'</span>)\n                webpackJsonpModule[chunkName + <span class=\"hljs-string\">'_'</span>] = webpackJsonpModule[chunkName];\n            }\n            <span class=\"hljs-comment\">// 调用模块的方法获得模块并设置到模块缓存区。</span>\n            webpackJsonpModule[chunkName] = Module();\n            <span class=\"hljs-comment\">// 取出回调方法</span>\n            resolve = webpackInstallModule[chunkName]\n            <span class=\"hljs-keyword\">if</span> (resolve) {\n                <span class=\"hljs-comment\">// 调用回调方法</span>\n                resolve(webpackJsonpModule[chunkName]);\n                <span class=\"hljs-comment\">// 删除已有回调方法</span>\n                webpackInstallModule[chunkName] = <span class=\"hljs-literal\">undefined</span>;\n            }\n        };\n        <span class=\"hljs-comment\">// 添加script标签.</span>\n        <span class=\"hljs-keyword\">var</span> webpackJsonp = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">webpackJsonp_</span>(<span class=\"hljs-params\">chunkName, resolve</span>) </span>{\n                webpackInstallModule[chunkName] = resolve;\n                <span class=\"hljs-keyword\">var</span> head = <span class=\"hljs-built_in\">document</span>.getElementsByTagName(<span class=\"hljs-string\">'head'</span>)[<span class=\"hljs-number\">0</span>];\n                <span class=\"hljs-keyword\">var</span> script = <span class=\"hljs-built_in\">document</span>.createElement(<span class=\"hljs-string\">'script'</span>);\n                script.type = <span class=\"hljs-string\">'text/javascript'</span>;\n                script.charset = <span class=\"hljs-string\">'utf-8'</span>;\n                script.async = <span class=\"hljs-literal\">true</span>;\n                script.src = chunkName;\n                head.appendChild(script);\n            }\n            <span class=\"hljs-comment\">// 获取模块方法。</span>\n        <span class=\"hljs-keyword\">var</span> webpack_require = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">webpack_require_</span>(<span class=\"hljs-params\">chunkName, resolve</span>) </span>{\n                <span class=\"hljs-keyword\">if</span> (chunkName) {\n                    <span class=\"hljs-keyword\">var</span> Module = webpackJsonpModule[chunkName];\n                    <span class=\"hljs-keyword\">if</span> (Module) {\n                        resolve(Module);\n                    } <span class=\"hljs-keyword\">else</span> {\n                        webpackJsonp(chunkName, resolve)\n                    }\n                }\n            }\n            <span class=\"hljs-comment\">// 将webpackJsonpCallback设置到全局上。</span>\n        <span class=\"hljs-built_in\">window</span>[<span class=\"hljs-string\">'webpackJsonpCallback'</span>] = webpackJsonpCallback;\n        <span class=\"hljs-comment\">// 返回webpack_require给requirejs调用。</span>\n        <span class=\"hljs-keyword\">return</span> webpack_require;\n    });\n})(define);\n</code></pre>\n<p>好了有了这个就可以做下面的了。</p>\n<h3><a class=\"anchor\" name=\"js/main.js\" href=\"#js/main.js\"><svg aria-hidden=\"true\" class=\"octicon octicon-link\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>js/main.js</h3><pre class=\"code javascript\"><code class=\"javascript\">(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">require, define</span>) </span>{\n    <span class=\"hljs-built_in\">require</span>.config({\n        <span class=\"hljs-attr\">paths</span>: {\n            <span class=\"hljs-string\">'vue'</span>: <span class=\"hljs-string\">'https://cdn.bootcss.com/vue/2.0.5/vue'</span>,\n            <span class=\"hljs-string\">'vue-router'</span>: <span class=\"hljs-string\">'https://cdn.bootcss.com/vue-router/2.0.1/vue-router'</span>,\n            <span class=\"hljs-string\">'webpackjsonp'</span>: <span class=\"hljs-string\">'/js/webpackjsonp'</span>\n        }\n    });\n\n    define(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">require, exports, module</span>) </span>{\n        <span class=\"hljs-keyword\">var</span> Vue = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'vue'</span>);\n        <span class=\"hljs-keyword\">var</span> VueRouter = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'vue-router'</span>);\n        Vue.use(VueRouter);\n        <span class=\"hljs-keyword\">var</span> webpack_require = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'webpackjsonp'</span>);\n        <span class=\"hljs-keyword\">var</span> router = <span class=\"hljs-keyword\">new</span> VueRouter({\n            <span class=\"hljs-attr\">routes</span>: [{\n                    <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">'/component1'</span>,\n                    <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">resolve</span>) </span>{\n                        webpack_require(<span class=\"hljs-string\">'/js/component1.js'</span>, resolve);\n                    }\n                },\n                {\n                    <span class=\"hljs-attr\">path</span>: <span class=\"hljs-string\">'/component2'</span>,\n                    <span class=\"hljs-attr\">component</span>: <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">resolve</span>) </span>{\n                        webpack_require(<span class=\"hljs-string\">'/js/component2.js'</span>, resolve);\n                    }\n                },\n            ]\n        })\n        <span class=\"hljs-keyword\">var</span> app = <span class=\"hljs-keyword\">new</span> Vue({\n            <span class=\"hljs-attr\">el</span>: <span class=\"hljs-string\">'#app'</span>,\n            <span class=\"hljs-attr\">router</span>: router,\n            <span class=\"hljs-attr\">template</span>: <span class=\"hljs-string\">'&lt;div class=\"content\"&gt;\\\n            &lt;h1&gt;Hello Content!&lt;/h1&gt;\\\n            &lt;p&gt;\\\n             &lt;router-link to=\"/component1\"&gt;Go to Component1&lt;/router-link&gt;\\\n             &lt;router-link to=\"/component2\"&gt;Go to Component2&lt;/router-link&gt;\\\n            &lt;/p&gt;\\\n            &lt;router-view&gt;&lt;/router-view&gt;\\\n            &lt;/div&gt;'</span>\n        });\n    });\n})(<span class=\"hljs-built_in\">require</span>, define);\n</code></pre>\n<p>html不变把里面的component改好即可</p>\n<h3><a class=\"anchor\" name=\"js/component1.js\" href=\"#js/component1.js\"><svg aria-hidden=\"true\" class=\"octicon octicon-link\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>js/component1.js</h3><pre class=\"code javascript\"><code class=\"javascript\">(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">define</span>) </span>{\n    define(<span class=\"hljs-string\">'/js/component1.js'</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">require, exports, module</span>) </span>{\n        <span class=\"hljs-keyword\">return</span> {\n            <span class=\"hljs-attr\">template</span>: <span class=\"hljs-string\">'&lt;span&gt;component1&lt;/span&gt;'</span>\n        }\n    });\n})(webpackJsonpCallback);\n</code></pre>\n<p>这个改动就比较大了。</p>\n<h3><a class=\"anchor\" name=\"js/component2.js\" href=\"#js/component2.js\"><svg aria-hidden=\"true\" class=\"octicon octicon-link\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>js/component2.js</h3><pre class=\"code javascript\"><code class=\"javascript\">(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">define</span>) </span>{\n    define(<span class=\"hljs-string\">'/js/component2.js'</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">require, exports, module</span>) </span>{\n        <span class=\"hljs-keyword\">return</span> {\n            <span class=\"hljs-attr\">template</span>: <span class=\"hljs-string\">'&lt;h1&gt;component2&lt;/h1&gt;'</span>\n        }\n    });\n})(webpackJsonpCallback);\n</code></pre>\n<p>多了一个模块名。。这样效果不是很好希望下回能研究出不需要模块名的。</p>\n<h3><a class=\"anchor\" name=\"效果图\" href=\"#效果图\"><svg aria-hidden=\"true\" class=\"octicon octicon-link\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>效果图</h3><p><img src=\"/public/img/vue_not_webpack_router-async/vue_router_async_demo.gif\" alt=\"vue_router_async_demo\"></p>\n<h3><a class=\"anchor\" name=\"源码\" href=\"#源码\"><svg aria-hidden=\"true\" class=\"octicon octicon-link\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>源码</h3><p>在git仓库的vue_router_async_demo分支。</p>\n"}